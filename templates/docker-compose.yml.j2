services:
  frontend:
    image: {{ frontend_image }}
    container_name: {{ container_name_prefix }}-frontend
    ports:
      - "{{ frontend_host_port }}:{{ frontend_container_port }}"
    networks:
      - {{ docker_network_name }}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:{{ frontend_container_port }}"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s
    environment:
      # Backend URL for frontend to access backend via internal network
      - BACKEND_URL=http://backend:{{ backend_container_port }}
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  backend:
    image: {{ backend_image }}
    container_name: {{ container_name_prefix }}-backend
    ports:
      - "{{ backend_host_port }}:{{ backend_container_port }}"
    networks:
      - {{ docker_network_name }}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:{{ backend_container_port }}/"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s
    environment:
      - NODE_ENV=production
      - PORT={{ backend_container_port }}
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  {{ docker_network_name }}:
    driver: bridge
    name: {{ docker_network_name }}

# Metadata for tracking deployment
# Generated by Ansible at {{ ansible_facts['date_time']['iso8601'] }}
# Deployed by: {{ ansible_user_id }}
